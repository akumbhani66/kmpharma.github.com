<script type="text/javascript" src="/js/vendor/lunr.min.js"></script>
<!--  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/0.7.2/lunr.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script> -->


<!-- onclick search -->
<script type="text/javascript">
  $("#search").on('input', function () {
      var val = this.value;
      if($('#results option').filter(function(){
        return this.value === val;
      }).length) {
        window.location = "/products/"+ this.value;
      }
  });
</script>
<!-- onclick search over -->


<!-- to highlight selected page on navbar -->
<script type="text/javascript">
  $(".nav a").on("click", function(event){
     $(".nav").find(".active").removeClass("active");
     $(this).parent().addClass("active");
  });
</script>
<!--  over highlighing -->


<!-- implementing search -->

<script type="text/javascript">
var lunrIndex,
    $results,
    pagesIndex;

window.onload = function(){
  $(".nav").find(".active").removeClass("active");
  var pathname = window.location.pathname;
  pathname = pathname.split('/')[1];
  if (pathname !== '') {
    $('li.'+ pathname).addClass('active');
  } else {
    $('li.home').addClass('active');
  }

  a = window.location.href;
  if(a.indexOf('search') > -1) {
    window.location = "/products/";
  }
}

// Initialize lunrjs using our generated index file
function initLunr() {
  // First retrieve the index file
  $.getJSON("/js/lunr/PagesIndex.json")
      .done(function(index) {
      pagesIndex = index;

      // Set up lunrjs by declaring the fields we use
      // Also provide their boost level for the ranking
      lunrIndex = lunr(function() {
        this.field("title", {
            boost: 10
        });
        this.field("tags", {
            boost: 5
        });
        this.field("content");

        // ref is the result item identifier (I chose the page URL)
        this.ref("href");
      });

      // Feed lunr with each file and let lunr actually index them
      pagesIndex.forEach(function(page) {
          lunrIndex.add(page);
      });
  })
  .fail(function(jqxhr, textStatus, error) {
      var err = textStatus + ", " + error;
      console.error("Error getting Hugo index flie:", err);
  });
}

// Nothing crazy here, just hook up a listener on the input field
function initUI() {
  $results = $("#results");
  $("#search").keyup(function(e) {
    if (String(e.keyCode) === String(40)) {
      return false;
    } else if (String(e.keyCode) === String(38)) {
      return false;
    } else if (String(e.keyCode) === String(13)) {
      var a = document.getElementById("search").value;
      window.location = "/products/"+ a;
      return false;
    } else {
      $results.empty();
      // Only trigger a search when 2 chars. at least have been provided
      var query = $('#search').val();
      if (query.length < 2) {
          return;
      }
      var results = search(query);
      renderResults(results);
    }
  });
}

function searchIt(event) {
  $results.empty();
  // Only trigger a search when 2 chars. at least have been provided
  var query = $(this).val();
  if (query.length < 2) {
      return;
  }
  var results = search(query);
  renderResults(results);
}
/**
 * Trigger a search in lunr and transform the result
 *
 * @param  {String} query
 * @return {Array}  results
 */
function search(query) {
  // Find the item in our index corresponding to the lunr one to have more info
  // Lunr result:
  //  {ref: "/section/page1", score: 0.2725657778206127}
  // Our result:
  //  {title:"Page1", href:"/section/page1", ...}
  return lunrIndex.search(query).map(function(result) {
    return pagesIndex.filter(function(page) {
        return page.href === result.ref;
    })[0];
  });
}

/**
 * Display the 10 first results
 *
 * @param  {Array} results to display
 */
function renderResults(results) {
  if (!results.length) {
      return;
  }
  var $results = $("#results");

  results.slice(0, 10).forEach(function(result, index) {
    $results.append("<option value='"+ result.href + "'></option>");
  });
}

// Let's get started
initLunr();

$(document).ready(function() {
    initUI();
});
</script>
